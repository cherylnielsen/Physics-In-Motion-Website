<?php

	include("html-includes/admin-section-forms/adminStudentAction.php");
	
	$addStudentAction = new adminStudentAction();
	$returnURL = "admin-home-page.php";
	$form_errors = "";
	
	if($_SERVER['REQUEST_METHOD'] == 'POST')
	{
		$result = array();
		$result = $addSection->processForm($mdb_control);
		$form_errors = $result['form_errors'];
	}
	
	if((count($result) > 0) && ($result['success'] == true))
	{
		// form processing, done reset form to all clear for next use
		$section_id = "";
		$student_id = "";
	}
	else
	{
		// checks GET and POST, if not set, returns empty string
		$section_id = $addStudentAction->getSectionID();
		$student_id = $addStudentAction->getStudentID();
	}
	
	$section_list = array();
	$section_list = $dataUtility->getListSectionIDNames($mdb_control);
	$student_list = array();
	$student_list = $dataUtility->getListStudentIDName($mdb_control);
	
	if($_SERVER['REQUEST_METHOD'] == 'POST')
	{
		$form_errors = $addStudentAction->processForm($mdb_control);
	}
	
	echo "<div class='form-errors' id='form_errors'> $form_errors </div>";
	
?>

<form id="addStudentForm" enctype="multipart/form-data" method="POST" >

	<fieldset>	
	<input type='hidden' name='action_type' value='add'>
	
	<h2 class="form">Adding Students to a Section</h2>
	
		<label>Select Section: &nbsp;&nbsp;
			<select id="section_id" name="section_id" required >
				<option value='' ></option>
				<?php
					for($i = 0; $i < count($section_list); $i++)
					{
						$sec_id = $section_list[$i]['id'];
						$name = $section_list[$i]['name'];
						$str = "<option value='$sec_id' >$name</option>";
						
						if(strcmp($section_id, $sec_id) == 0)
						{
							$str = "<option value='$sec_id' selected >$name</option>";
						}
						
						echo "$str";
					}				
				?>
		</select></label><br>
		
		<h2 class="form red">WARNING: Add a single student OR a file, but not both.</h2>
		
		<h2 class="form">Add Single Student to Section</h2>	
		
		<label>Select Student: 
			<select id="student_id" name="student_id" >
				<option value='' ></option> 
				<?php
					for($i = 0; $i < count($student_list); $i++)
					{
						$member_id = $student_list[$i]['id'];
						$name = $student_list[$i]['name'];
						$str = "<option value=$member_id >$name</option>";
						
						if(strcmp($student_id, $member_id) == 0)
						{
							$str = "<option value=$member_id selected >$name</option>";
						}
						
						echo "$str";
					}
				?>
		</select></label><br>
	
		<h2 class="form">Add Multiple Students to Section</h2>
		
			<label>File Listing Students to Add:
			<ul>
				<li><p>Comma delimited ".csv" file, with one student per line.</p></li>
				<li><p>File format 4 values per line: section id, student id, first name, last name</p></li>
				<li><p>The file must have no heading, tile, or other information included.</p></li>
			</ul>
				<input type="file" name="attachments[]" id="attachments">
			</label>
			
			<p id="fileListing"></p><br>
		
		<div class="formButtonDiv">
			<input type="submit" value="Add Students">		
			<a href='<?php echo "$returnURL" ?>' class='button red'>Cancel</a>		
		</div>
	</fieldset>
</form>